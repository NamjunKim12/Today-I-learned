## 프로세스와 스레드

### 프로그램 -> 프로세스

 **프로그램** : 어떤 작업을 하기 위해 실행할 수 있는 파일 또는 프로그램(.exe, .dmg), 정적인 상태

 **프로세스** : 운영체제로부터 할당받은 **최소 작업의 단위**

- **프로그램**은 단순한 **코드 덩어리**로, SSD와 HDD등의 저장장치에 저장돼있다. 우리가 어떤 프로그램을 실행하면, 저장장치에 있는 파일이 메모리에 올라가고 CPU에 작업이 할당된다. 이러한 작업 단위를 총칭하여 **프로세스**라고 한다.

> 프로그램은 코드 덩어리(=실행안된 프로그램), 그것을 실행한 것이 프로세스(=실행중인 프로그램)

### 프로세스의 구조

프로세스는 다음과 같은 구조를 갖는다.

![image](https://user-images.githubusercontent.com/69416561/195591449-88234093-f2fd-4bcd-83b2-60bfe36da605.png)

1. **코드 영역** : 프로그래머가 작성한 프로그램이 코드 영역에 작성된다. (정적 영역)

2. **데이터 영역** : 코드가 실행되면서 사용한 변수나 파일들의 데이터들이 모여있다. (정적 영역)

3. **스택 영역** : 호출한 함수가 종료되면 돌아올 메모리 주소를 스택에 저장하거나 변수 사용 범위에 영향을 미치는 영역을 구현할 때 사용한다.(동적 영역)

4. **힙 영역** : 동적으로 할당되는 데이터들을 위해 존재하는 공간이다. (동적 영역)

- 코드 영역과 데이터 영역은 **선언할때 크기가 결정**되는 정적 영역이지만, 스택 영역과 힙 영역은 프로세스가 실행되는 동안 크기가 **늘어났다 줄어들기도 하는** 동적 영역이다.

### 프로세스의 특징
- 원칙적으로 서로 다른 프로세스 간의 메모리 공간 접근은 허용되지 않는다. (만약 해야한다면 IPC통신 해야함)
- 우리가 카톡을 하고, 동시에 노래를 듣고, 동시에 게임을 할 수 있는 것은 실제로 동시에 프로세스를 처리하는 것이 아니다. CPU는 한번에 한가지 명령어 밖에 처리하지 못하기 때문이다. 상상이상으로 빠른 CPU의 작업처리능력 덕분에, 여러 프로세스를 번갈아서 한번씩 처리해도 **동시적**으로 작업하는 것 처럼 보이는 것이다.(동시성) 

### 프로세스 제어 블록(PCB)

- 우리가 어떤 프로그램을 실행하여 작업이 할당되면, 프로세스가 생성된 동시에 **해당 프로세스의 정보를 기록한 자료구조**인 PCB를 생성한다. 만약 작업중인 프로세스에 전환이 일어나면 해당 작업을 저장하고 CPU에 반환 후, PCB에 저장해준다. 이후 다시 할당 받게 되면 저장된 내용을 불러와 종료된 시점부터 작업을 수행한다.
- PCB에는 해당 프로세스의 식별자, 포인터 등 스케쥴링 정보, 입출력 정보 등의 다양한 정보가 들어간다.


### 프로세스 -> 스레드

> 스레드 : 프로세스가 할당받은 자원을 이용하는 **실행 흐름**의 단위

- 과거의 원시적인 프로그램은 실행할때부터 끝까지 프로세스 하나만을 사용해서 진행됐다. 하지만 현대의 99.x% 프로그램들은 여러 작업을 하므로 프로그램을 실행하기는 벅차다. 
- 이런 경우에 프로세스를 여러개 만들면 어떨까? 라고 생각하겠지만, 프로세스마다 할당된 메모리 내의 정보에만 접근할 수 있고 다른 프로세스 끼리 메모리 공간 접근이 허용되지 않음
- 따라서 **프로세스보다 더 작은** 실행 단위가 고려됐고, 그것을 통틀어 **스레드**라고 한다.

### 스레드의 특징 

<img width="771" alt="스크린샷 2022-10-13 오후 9 22 36" src="https://user-images.githubusercontent.com/69416561/195594905-df1d9a47-a058-4c7c-b98f-f2ef010dd87d.png">

- 하나의 프로세스는 반드시 하나 이상의 스레드를 갖는다.
- 스레드는 프로세스 내에서 각각 스택 영역만 할당 받고, 코드, 데이터, 힙 영역은 부모 프로세스와 공유한다.
- 스레드는 **프로세스 안에서 동작하는 여러 실행의 흐름단위**를 말하며, 같은 프로세스 안에 존재하는 스레드는 같은 힙공간을 공유한다.
- 즉, **프로세스는 자원을 공유하지 않지만, 스레드는 자원을 공유한다.**

### 스레드 vs 프로세스
- 프로세스의 메모리 영역은 각각 독립되어있고, 스레드는 스택영역은 메모리에 따로 할당받지만 **나머지 메모리영역은 공유한다.** 즉 별도의 스택을 가지고 있지만 힙 메모리는 서로 읽고 쓸 수 있다. 
- 이렇게 영역을 공유하는 스레드의 특성상 스레드 하나에서 오류가 발생하면, 같은 프로세스 내의 다른 스레드가 모두 강제종료된다. 최소한의 '작업흐름'이라고 하는데 그 흐름이 끊기는 것이다.
- 반면 프로세스는 메모리를 공유하지 않기때문에 다른 프로세스가 종료되도 다른 프로세스의 작업에 영향을 끼치지 않는다.(카톡 오류났다고 크롬이 꺼지는게 아니듯) 
- 스레드는 **CPU 입장에서의 최소 작업 단위이고,** 프로세스는 **운영체제 관점에서의 최소 작업 단위**이다.

## 멀티 프로세스와 멀티 스레드

<img width="515" alt="스크린샷 2022-10-13 오후 9 43 54" src="https://user-images.githubusercontent.com/69416561/195599277-19064bf4-844b-4db9-a359-5b0b28d2a332.png">

### 멀티 프로세스
- 멀티 프로세스란, 하나의 애플리케이션을 여러 개의 프로세스로 구성해서 각 프로세스가 하나의 작업을 처리하도록 하는 것이다.(부모 프로세스에서 fork()하여 자식 프로세스 생성)
- 구현이 간단하고, 각 프로세스들이 독립적으로 동작하며 자원 또한 다르게 할당된다.
- 프로세스간 통신을 위해서는 IPC가 필요하다.
- 메모리 사용량이 많다.
- 스케쥴링에 따른 콘텍스트 스위칭(CPU는 한번에 한개에 작업밖에 하지 못하므로 한 작업이 수행되면 다른 작업이 빠지는걸 반복)이 많아지고, 성능저하의 우려가 있다.

<img width="528" alt="스크린샷 2022-10-13 오후 9 50 41" src="https://user-images.githubusercontent.com/69416561/195600868-f50ce8ef-9760-4c19-a062-dd2686d74a46.png">

### 멀티 스레드
- 멀티 스레드란 하나의 애플리케이션을 여러 개의 스레드로 구성하여 하나의 스레드가 하나의 작업을 처리하도록 하는 것이다.
- 컨텍스트 스위칭 시 공유하는 메모리 만큼의 메모리를 아낄 수 있다.(공유하지 않는 스택 영역만 스위칭하면 되기 떄문)
- 스택 영역을 제외한 모든 메모리를 공유하기 때문에 통신의 부담이 없고, 응답 시간이 빠르다.
- 스레드 하나가 프로세스 자원을 망친다면 모든 프로세스가 종료된다. 즉, 멀티프로세스에 비해 안정성이 부족하다. 
- 구현 및 테스트, 디버깅이 어렵다.
- 자원을 공유하기 때문에 필연적으로 **동기화 문제**가 발생한다. 
- 즉, 여러 스레드가 같은 전역변수를 처리할 경우 충돌이 발생할 수 있다. 스레드는 운영체제가 스케줄링을 자동으로 해주지 않아 프로그래머가 적절한 스케줄링 기법을 구현해야한다. 

