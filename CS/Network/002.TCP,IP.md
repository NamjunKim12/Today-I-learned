## 📌 TCP/IP 4계층 모델

- `TCP/IP`는 인터넷에서 컴퓨터들이 서로 정보를 주고받는데 쓰이는 프로토콜의 집합임.
- TCP/IP는 프로토콜의 네트워킹 범위에 따라 네 개의 추상화 계층으로 구성됨.
  
### 📌 TCP/IP의 계층 구조 

- `TCP/IP`는 `OSI 7계층`과 비슷한 계층 구조를 가지고 있음.
- `TCP/IP`는 `OSI 7계층`의 애플리케이션 계층, 프레젠테이션 계층, 세션 계층을 하나의 계층으로 통합하여 `애플리케이션 계층`이라고 정의하고, `데이터 링크 계층`과 `물리 계층`을 하나의 계층으로 통합하여 `링크 계층`이라고 정의함.
- 즉 `애플리케이션 계층 - 전송 계층 - 인터넷 계층 - 링크 계층`으로 구성되는 것임.

### 📌 애플리케이션 계층

- `애플리케이션 계층`은 `OSI 7계층`의 `애플리케이션 계층`, `프레젠테이션 계층`, `세션 계층`을 포함하는 계층임.
- `FTP, HTTP, SSH, DNS, SMTP` 등 응용 프로그램이 사용됨.

### 📌 전송 계층

- 전송 계층은 송신자와 수신자를 연결하며, 애플리케이션과 인터넷 계층 사이의 데이터 중계 역할을 함.
- 전송 계층의 대표적 두 프로토콜로는 `TCP`, `UDP`가 있음.
- TCP는 패킷의 전송순서를 보장하고, 수신 여부를 확인하는 반면, UDP는 패킷의 전송순서를 보장하지 않고, 수신 여부를 확인하지 않음.
- TCP는 `HTTP`와 같은 신뢰성이 중요한 프로토콜에 사용되고, UDP는 `DNS`와 같이 신뢰성이 중요하지 않은 프로토콜에 사용됨.
- TCP는 `3-way handshake`를 통해 연결을 설정하고, `4-way handshake`를 통해 연결을 해제함.

#### 📌 3-way handshake

- `3-way handshake`는 TCP/IP 프로토콜을 이용해서 통신을 하는 응용프로그램이 데이터를 전송하기 전에 먼저 **정확한 전송을 보장**하기 위해 상대방과 사전에 세션을 수립하는 과정임.
- `3-way handshake`는 다음과 같은 순서로 이루어짐.
  1. 클라이언트가 서버에게 패킷의 시퀀스 번호인 ISN을 담아 `SYN(연결 요청 플래그)` 패킷을 보냄.
  2. 서버가 전송된 SYN를 받고, 클라이언트에게 서버의 ISN을 담아 ISN+1이 포함된`SYN+ACK(응답 플래그)` 패킷을 보냄. 
  3. 클라이언트가 서버에게 ISN+1의 값인 `ACK(응답 플래그)` 패킷을 보냄.
- `3-way handshake`가 완료되면 `Client`와 `Server`는 연결이 설정되고, 데이터 전송을 시작함.

#### 📌 4-way handshake

- `4-way handshake`는 3-way handshake를 통해 연결된 `Client`와 `Server`가 연결을 해제하기 위해 사용되는 과정임.
  1. 과정에서 클라이언트가 서버에게 연결을 종료하겠다는 FIN 플래그를 전송함.
  2. 과정에서 서버는 클라이언트의 요청(FIN)을 받고, 클라이언트에게 승인 플래그인 ACK를 보냄.
  3. 과정에서 서버가 클라이언트에게 연결을 종료하겠다는 FIN 플래그를 전송함.
  4. 과정에서 클라이언트는 서버의 요청(FIN)을 받고, 서버에게 승인 플래그인 ACK를 보내고 서버는 CLOSE 상태가 됨.
- 이후 어느 정도의 대기시간을 거친 후, 연결이 닫히고 클라이언트와 서버의 모든 자원의 연결이 종료됨.

### 📌 인터넷 계층

- `인터넷 계층`은 장치로부터 받은 데이터를 패킷 단위로 캡슐화하고, 목적지까지 패킷을 전달하는 역할을 함.
- 해당 계층은 패킷을 받았는지 여부를 보장하지 않는 비연결적인 특징을 가짐.

### 📌 링크 계층

- `링크 계층`은 실질적으로 데이터를 전달하며 장치간의 무선 또는 유선 연결을 담당함.
- OSI7 계층의 `데이터 링크 계층`과 `물리 계층`을 포함하는 계층임. 
- 유선 LAN, 무선 LAN 등이 해당 계층에 속함.
- `유선 LAN`은 광케이블, 동축 케이블, 트위스트 케이블 등을 사용하고, `무선 LAN`은 무선 주파수를 사용함.
- 유선랜은 송수신을 동시에 할 수 있는 `전이중(Full-Duplex)` 방식을 사용하고, 무선랜은 송수신을 번갈아가며 하는 `반이중(Half-Duplex)` 방식을 사용함.

### 📌 계층 간 데이터 송수신 과정

- HTTP 프로토콜을 사용하여 양 컴퓨터가 통신을 한다고 가정하면, 송신자 측의 요청값들이 캡슐화 과정을 거쳐서 전달되고, 수신자 측에서는 캡슐화된 데이터를 역순으로 해제하여 요청값을 확인함.
  1. 애플리케이션 계층의 데이터가 전송 계층으로 전달되면, 전송 계층에서는 데이터를 `세그먼트`(UDP의 경우에는 데이터그램)화하여 인터넷 계층으로 전달함.
  2. 인터넷 계층에서는 전송받은 세그먼트에 IP헤더를 붙이고, `패킷화`하여 링크 계층으로 전달함.
  3. 이후 링크 계층으로 전달된 패킷에는 `프레임` 헤더와 트레일러가 붙어서 물리 계층으로 전달됨.
  4. 수신자 측에서는 이렇게 캡슐화된 데이터를 역순으로 비캡슐화하여 요청값을 확인함.


### 📌 PDU

- `PDU(Protocol Data Unit)`는 각 계층에서 주고받는 데이터의 단위를 의미함.
- 각 계층에서는 PDU를 캡슐화하여 상위 계층으로 전달하고, 캡슐화된 PDU를 역순으로 비캡슐화하여 하위 계층으로 전달함.
- 에플리케이션 계층의 데이터는 `메시지`이고, 전송 계층의 데이터는 `세그먼트`(UDP의 경우는 데이터그램)이며, 인터넷 계층의 데이터는 `패킷`이고, 링크 계층의 데이터는 `프레임, 비트`임.